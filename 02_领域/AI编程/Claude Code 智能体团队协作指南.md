---
title: "Claude Code 智能体团队协作指南"
source: "https://code.claude.com/docs/en/agent-teams"
author:
  - "[[Claude Code Docs]]"
published:
created: 2026-02-06
description: "让多个 Claude Code 实例像团队一样协作，共享任务、相互通信、统一管理"
tags:
  - "AI编程"
  - "Claude Code"
  - "智能体"
---

> [!warning] 实验性功能
> 智能体团队（Agent Teams）目前是**实验性功能**，默认关闭。
>
> **开启方法**：在 `settings.json` 或环境变量中添加 `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS`
>
> **已知限制**：会话恢复、任务协调、关闭行为等方面还存在一些问题。

---

## 什么是智能体团队？

简单来说，智能体团队就是**让多个 Claude Code 同时工作**，就像一个真正的开发团队：

- **一个队长**（Lead）：负责分配任务、协调工作、汇总结果
- **多个队员**（Teammates）：各自独立工作，可以相互沟通

### 和子智能体（Subagent）有什么区别？

| 特性 | 子智能体 | 智能体团队 |
|------|----------|------------|
| 运行方式 | 在主会话内部运行 | 每个成员都是独立会话 |
| 通信方式 | 只能向主智能体汇报 | 成员之间可以相互通信 |
| 你能直接交流吗 | 不能，必须通过主智能体 | 可以，直接和任何成员对话 |
| 适用场景 | 快速、聚焦的小任务 | 需要讨论、挑战、协调的复杂任务 |

> **一句话总结**：
> - 子智能体 = 你派出去的"跑腿小弟"，干完活回来汇报
> - 智能体团队 = 真正的"项目组"，成员之间可以讨论和协作

---

## 什么时候该用智能体团队？

### ✅ 适合的场景

| 场景           | 为什么适合                          |
| ------------ | ------------------------------ |
| **研究和代码审查**  | 多个成员可以同时调查问题的不同方面，然后分享和挑战彼此的发现 |
| **开发新模块/功能** | 每个成员负责一个独立的模块，互不干扰             |
| **调试复杂问题**   | 多个成员同时测试不同的假设，更快找到答案           |
| **跨层协调**     | 前端、后端、测试各由不同成员负责               |

### ❌ 不适合的场景

| 场景 | 为什么不适合 |
|------|------------|
| 任务必须按顺序执行 | 并行工作没有意义 |
| 多人需要编辑同一个文件 | 会产生冲突 |
| 任务之间依赖太多 | 协调成本太高 |

> [!tip] 成本提醒
> 智能体团队会**消耗更多 Token**，因为每个成员都有自己的上下文窗口。
> 如果任务简单，用单个会话或子智能体更划算。

---

## 快速上手

### 第一步：开启功能

在 `settings.json` 中添加：

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

### 第二步：用自然语言创建团队

直接告诉 Claude 你想要什么样的团队，比如：

```
请创建一个智能体团队来调查这个性能问题：
- 一个成员分析数据库查询
- 一个成员检查内存使用
- 一个成员审查最近的代码变更
```

Claude 会自动：
1. 创建团队和共享任务列表
2. 为每个角色生成一个成员
3. 让他们开始工作
4. 完成后汇总结果

---

## 控制你的团队

### 显示模式

有两种显示方式：

| 模式 | 说明 | 如何切换成员 |
|------|------|-------------|
| **内嵌模式**（默认） | 所有成员在同一个终端窗口运行 | 按 `Shift+上/下` 切换 |
| **分屏模式** | 每个成员有自己的窗口 | 直接点击对应窗口 |

**分屏模式需要安装**：
- macOS：tmux 或 iTerm2
- 其他系统：tmux

设置方法（在 `settings.json` 中）：

```json
{
  "teammateMode": "tmux"  // 或 "inprocess" 强制使用内嵌模式
}
```

### 指定团队成员

你可以具体说明想要几个成员、分别做什么：

```
创建3个成员的团队：
- 一个负责安全审查
- 一个负责性能分析
- 一个负责测试覆盖率检查
```

### 让成员先规划再动手

对于复杂或有风险的任务，可以要求成员先写计划：

```
让成员在开始实现之前先提交计划给我审批
```

工作流程：
1. 成员在"只读规划模式"下工作
2. 完成规划后，发送给队长审批
3. 队长批准 → 成员开始实现
4. 队长拒绝 → 成员修改计划后重新提交

### 委托模式（Delegate Mode）

有时候队长会忍不住自己动手写代码，而不是分配任务。

**开启委托模式**：按 `Shift+Tab`

这会限制队长只能做协调工作：生成成员、发消息、管理任务，不能直接写代码。

### 直接和成员对话

每个成员都是完整的 Claude Code 会话，你可以：

- **内嵌模式**：`Shift+上/下` 选择成员，然后直接输入消息
- **分屏模式**：点击成员的窗口，直接交互

按 `Ctrl+T` 可以切换任务列表的显示。

### 任务管理

任务有三种状态：
- ⏳ **待处理**（pending）
- 🔄 **进行中**（in progress）
- ✅ **已完成**（completed）

任务分配方式：
- **队长分配**：你告诉队长把什么任务给谁
- **成员自取**：成员完成一个任务后，自动认领下一个可用任务

### 关闭成员

```
请关闭负责前端的那个成员
```

队长会发送关闭请求，成员可以批准（优雅退出）或拒绝（说明原因）。

### 清理团队

工作完成后：

```
请清理这个团队
```

> [!warning] 注意
> - 清理前要先关闭所有成员
> - 一定要通过队长来清理，不要让成员执行清理操作

---

## 工作原理（了解即可）

### 架构

```
┌─────────────────────────────────────────┐
│              你（用户）                  │
│                  │                      │
│                  ▼                      │
│         ┌───────────────┐               │
│         │    队长       │               │
│         │   (Lead)      │               │
│         └───────┬───────┘               │
│                 │                       │
│    ┌────────────┼────────────┐          │
│    ▼            ▼            ▼          │
│ ┌──────┐   ┌──────┐    ┌──────┐        │
│ │成员A │   │成员B │    │成员C │        │
│ └──────┘   └──────┘    └──────┘        │
│                                         │
│        [共享任务列表]                    │
└─────────────────────────────────────────┘
```

### 本地存储位置

- 团队配置：`~/.claude/teams/{团队名}/config.json`
- 任务列表：`~/.claude/tasks/{团队名}/`

### 权限

成员继承队长的权限设置。如果队长用了 `--dangerously-skip-permissions`，所有成员也会跳过权限检查。

### 通信机制

- **消息自动送达**：成员发的消息会自动送到接收者手中
- **空闲通知**：成员完成工作后会自动通知队长
- **共享任务列表**：所有成员都能看到任务状态

---

## 实战案例

### 案例1：并行代码审查

**场景**：需要全面审查一个 PR

**传统方式的问题**：一个人审查容易只关注某一类问题

**团队方式**：

```
创建一个代码审查团队：
- 成员1：专注安全问题（SQL注入、XSS、认证漏洞）
- 成员2：专注性能问题（N+1查询、内存泄漏、算法复杂度）
- 成员3：专注测试覆盖（边界条件、错误处理、mock是否合理）

审查完成后，队长汇总所有发现。
```

### 案例2：调查竞争假设

**场景**：生产环境出现神秘 bug，原因不明

**传统方式的问题**：找到一个看起来合理的解释就停止了

**团队方式**：

```
创建一个调试团队，用"竞争假设"模式：
- 成员1：调查是否是最近的代码变更导致
- 成员2：调查是否是基础设施/配置问题
- 成员3：调查是否是数据问题

关键：每个成员不仅要调查自己的假设，还要尝试反驳其他成员的假设。
最终存活下来的假设最可能是真正的原因。
```

---

## 最佳实践

### 1. 给成员足够的上下文

成员会自动加载项目上下文（CLAUDE.md、MCP 服务器等），但**不会继承队长的对话历史**。

所以在生成成员时，要在提示词中包含任务相关的细节：

```
创建一个成员来修复用户认证bug：
- 问题在 src/auth/login.ts 文件中
- 错误信息是 "token expired unexpectedly"
- 只在高并发情况下出现
```

### 2. 任务大小要适中

| 任务大小 | 问题                                 |
| ---- | ---------------------------------- |
| 太小   | 协调成本大于收益                           |
| 太大   | 成员工作太久不检查，可能浪费精力                   |
| 刚好   | 独立的单元，能产出明确的成果（一个函数、一个测试文件、一份审查报告） |
|      |                                    |

**经验法则**：每个成员分配 5-6 个任务比较合适。

### 3. 避免文件冲突

两个成员编辑同一个文件会导致覆盖。合理分工，让每个成员负责不同的文件。

### 4. 定期检查进度

不要让团队无人看管地运行太久。定期检查成员进度，及时纠正不对的方向。

### 5. 从简单任务开始

如果你是第一次用智能体团队，建议从不需要写代码的任务开始：
- 审查 PR
- 研究某个库
- 调查某个 bug

这些任务能让你体验并行探索的价值，又不会遇到并行实现的协调难题。

---

## 常见问题

### 成员没有出现

- **内嵌模式**：按 `Shift+下` 看看是不是已经在运行了
- **分屏模式**：检查 tmux 是否安装（运行 `which tmux`）
- 检查任务是否足够复杂，简单任务 Claude 可能不会创建团队

### 队长提前结束工作

有时候队长会在任务完成前就决定"工作做完了"。

**解决**：告诉队长继续，或者让它等待成员完成后再继续。

### 残留的 tmux 会话

如果团队结束后 tmux 会话还在：

```bash
# 查看所有会话
tmux ls

# 杀掉特定会话
tmux kill-session -t 会话名
```

---

## 当前限制

| 限制          | 说明                                        |
| ----------- | ----------------------------------------- |
| 无法恢复会话中的成员  | `/resume` 不会恢复内嵌模式的成员                     |
| 任务状态可能延迟    | 成员有时忘记标记任务完成                              |
| 关闭较慢        | 成员需要完成当前操作才会退出                            |
| 每个会话只能有一个团队 | 先清理旧团队才能创建新团队                             |
| 不能嵌套团队      | 成员不能创建自己的团队                               |
| 队长不能换       | 创建团队的会话永远是队长                              |
| 分屏需要特定终端    | 不支持 VS Code 集成终端、Windows Terminal、Ghostty |
|             |                                           |

---

## 相关资源

- [[Orchestrate teams of Claude Code sessions|原文（英文）]]
- [子智能体文档](https://code.claude.com/docs/en/sub-agents)
- [Git Worktrees 并行工作](https://code.claude.com/docs/en/common-workflows#run-parallel-claude-code-sessions-with-git-worktrees)
